@(tpl: models.MainTemplate, service: core.ServiceDescription)(implicit flash: Flash)

@main(tpl) {

  @service.description.getOrElse("")

  <div class="pull-right">
    <a href="@routes.Versions.create(orgKey = tpl.org.get.key, version = Some(tpl.version.get))">Upload new version</a>
    <br/>
    <a href="@routes.Versions.apiJson(orgKey = tpl.org.get.key, serviceKey = tpl.service.get.key, version = tpl.version.get)">api.json</a>
    <br/>
    <a href="@codegen.routes.Play2.getClient(org = tpl.org.get.key, service = tpl.service.get.key, version = tpl.version.get)">Codegen: Play 2 Client</a>
    <br/>
    <a href="@codegen.routes.Play2.getRoutes(org = tpl.org.get.key, service = tpl.service.get.key, version = tpl.version.get)">Codegen: Play 2 Routes</a>
    <br/>
    <a href="@codegen.routes.RubyGenerator.gem(org = tpl.org.get.key, service = tpl.service.get.key, version = tpl.version.get, filename = "%s-%s-%s.rb".format(tpl.org.get.key, tpl.service.get.key, tpl.version.get))">Codegen: Ruby Gem</a>
  </div>

  <div class="pull-left">
    <h2>Resources</h2>
    <table class="table table-hover table-condensed">
      <tbody>
        @service.resources.map { resource =>
         <tr>
           <td><a href="#model-@core.UrlKey.generate(resource.model.name)">@resource.model.name</a></td>
           <td>@resource.path</td>
           <td>@core.Text.truncate(resource.model.description.getOrElse(""))</td>
         </tr>
       }
      </tbody>
    </table>


    <h2>Models</h2>
    <table class="table table-hover table-condensed">
      <tbody>
        @service.models.map { model =>
         <tr>
           <td><a href="#model-@core.UrlKey.generate(model.name)">@model.name</a></td>
           <td>@core.Text.truncate(model.description.getOrElse(""))</td>
         </tr>
       }
      </tbody>
    </table>


    @service.resources.map { resource =>
      <div id="model-@core.UrlKey.generate(resource.model.name)"></div>
      <a name="model-@core.UrlKey.generate(resource.model.name)"></a>
      <div class="version_resource">
        <h2>@resource.model.name</h2>

        @resource.model.description.getOrElse("")

        <h3>Fields</h3>
        @fields(resource.model.fields)

        <h3>Operations</h3>
        @if(resource.operations.isEmpty) {
          <em>No operations</em>
        } else {
          <table class="table table-hover table-condensed">
            <thead>
              <tr>
                <th colspan="2">Method and Path</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
             @resource.operations.zipWithIndex.map { case(operation, index) =>
               <tr>
                 <td class="nowrap"><a onClick="$('#operation-@core.UrlKey.generate(resource.model.name)-@index').toggle()">@operation.method</a></td>
                 <td class="nowrap"><a onClick="$('#operation-@core.UrlKey.generate(resource.model.name)-@index').toggle()">@operation.path</a></td>
                 <td>@operation.description.getOrElse("")</td>
               </tr>
               <tr id="operation-@core.UrlKey.generate(resource.model.name)-@index" style="display:noneTest">
                 <td></td>
                 <td colspan="2">
                   @operation.method @service.baseUrl@operation.path

                   <h3>Parameters</h3>
                   @if(operation.parameters.isEmpty) {
                     <em>No parameters</em>
                   } else {
                     @parameters(operation.parameters)
                   }

                   <h3>Response</h3>
                   @operation.responses.map { response =>

                     <p>
                       HTTP @response.code:
                       @if(response.multiple) {
                         [@parameterType(tpl.org.get, tpl.service.get, tpl.version.get, service, response.datatype)]
                       } else {
                         @parameterType(tpl.org.get, tpl.service.get, tpl.version.get, service, response.datatype)
                       }
                     </p>
                   }
                 </td>

               </tr>
             }
            </tbody>
          </table>
        }

      </div>
    }

    @service.modelsWithoutResources.map { model =>
      <div id="model-@core.UrlKey.generate(model.name)"></div>
      <a name="model-@core.UrlKey.generate(model.name)"></a>
      <div class="version_model">
        <h2>@model.name</h2>

        @model.description.getOrElse("")

        <h3>Fields</h3>
        @fields(model.fields)
      </div>
    }
  </div>
}
